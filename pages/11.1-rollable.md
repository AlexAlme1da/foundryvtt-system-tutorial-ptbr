# Criando botões roláveis com listeners de evento

Para tornar coisas na sua ficha de personagem roláveis, você precisará adicionar uma classe que você pode ouvir no método `activateListeners()` da sua ficha. No Boilerplate System, as rolagens de atributos têm um exemplo disso com uma classe `rollable`. Vamos olhar a linha do modificador de atributo de `actor-sheet.html`:

```handlebars
<span class="ability-mod rollable" data-roll="d20+@abilities.{{key}}.mod" data-label="{{key}}">{{numberFormat ability.mod decimals=0 sign=true}}</span>
```

Adicionamos uma classe `rollable` junto com alguns atributos diferentes para `data-roll` e `data-label` que nosso listener pode então usar para criar as rolagens. Esses atributos não são realmente necessários; como esta é uma ficha de personagem, poderíamos apenas adicionar a classe rollable e então calcular essas rolagens no JS. No entanto, ao torná-los atributos, podemos apenas incluir os atributos com qualquer fórmula que precisarmos, e o `data-label` aparecerá na mensagem de chat como texto de sabor.

A fórmula neste exemplo inclui `@abilities.{{key}}.mod`, que seria calculada como `@abilities.str.mod`, por exemplo. Isso deve seguir o mesmo formato se você fosse escrever rolagens inline no chat ou em macros, porque no método de rolagem que estamos prestes a fazer, estamos passando `this.actor.data.data` assim como o core faz para esses cenários.

Finalmente, a classe `rollable` também inclui algum CSS leve para transformar o mouse em um ponteiro e adicionar uma sombra de texto vermelha ao passar o mouse ou focar.

### activateListeners()

A seguir, vamos dar uma olhada em `actor-sheet.js` onde sobrescrevemos a classe ActorSheet. Precisamos adicionar um novo listener de clique dentro do método `activateListeners()` do nosso ActorSheet:

```js
// Rollable abilities.
html.find('.rollable').click(this._onRoll.bind(this));
```

Isso chamará um método customizado `_onRoll()` no clique. Como esse método não existe, precisamos descer até o final da nossa classe e adicionar um novo método após o método `_onItemCreate()`:

```js
/**
 * Handle clickable rolls.
 * @param {Event} event   The originating click event
 * @private
 */
_onRoll(event) {
  event.preventDefault();
  const element = event.currentTarget;
  const dataset = element.dataset;

  if (dataset.roll) {
    let roll = new Roll(dataset.roll, this.actor.data.data);
    let label = dataset.label ? `Rolling ${dataset.label}` : '';
    roll.roll().toMessage({
      speaker: ChatMessage.getSpeaker({ actor: this.actor }),
      flavor: label
    });
  }
}
```

Primeiro, estamos prevenindo outros comportamentos de clique (como se este fosse uma tag `<a>`), e então estamos pegando tanto o elemento que foi clicado quanto quaisquer atributos de dados que foram incluídos naquele elemento (`data-roll` e `data-label`, especificamente).

A seguir, se houver um atributo `dataset.roll`, usaremos isso para construir a rolagem. Para criar uma rolagem, usamos `new Roll('formula')`, e já escrevemos a fórmula no nosso template Handlebars. O segundo argumento de Roll() é o objeto a usar para seus dados, então neste caso queremos passar os atributos de dados do ator.

Depois disso, pegamos o atributo label, se houver. E com isso temos tudo o que precisamos para enviar para o chat. Criar uma nova rolagem não a rola de fato, então temos que chamar o método `roll()` no nosso objeto Roll, e então chamar o método `toMessage()` nesse resultado para enviá-lo ao chat. Queremos que isso referencie o token do ator como o orador para a mensagem de chat, então definimos as propriedades speaker e flavor para corresponder ao que precisamos.

E com isso, fizemos com sucesso atributos roláveis!

- **Anterior:** [Estendendo a classe ItemSheet](https://github.com/AlexAlme1da/foundryvtt-system-tutorial-ptbr/blob/master/pages/10-extending-item-sheet-class.md)
- **Próximo:** [Agrupando itens por tipo](https://github.com/AlexAlme1da/foundryvtt-system-tutorial-ptbr/blob/master/pages/11.3-grouping-items.md)
<!--stackedit_data:
eyJoaXN0b3J5IjpbMzgxMjk0ODYyLDQ0NTYzMjU3NCw5NjE3NT
AwNjBdfQ==
-->
